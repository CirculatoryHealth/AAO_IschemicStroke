---
title: "Simluation plot for age of ischemic stroke onset."
author: "[Sander W. van der Laan, PhD](https://swvanderlaan.github.io) | @swvanderlaan | s.w.vanderlaan@gmail.com"
date: "`r Sys.Date()`"
output:
  html_notebook:
    cache: yes
    code_folding: hide
    collapse: yes
    df_print: paged
    fig.align: center
    fig_caption: yes
    fig_height: 6
    fig_retina: 2
    fig_width: 7
    highlight: tango
    theme: lumen
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: yes
mainfont: Arial
subtitle: "A 'druggable-MI-targets' project"
editor_options:
  chunk_output_type: inline
---

# General Setup
We will clean the environment, setup the locations, define colors, and create a datestamp.

_Clean the environment._
```{r echo = FALSE}
rm(list = ls())
```

_Set locations and working directories..._
```{r LocalSystem, echo = FALSE}
source("scripts/local.system.R")

```

_... a package-installation function ..._
```{r Function: installations}
source("scripts/functions.R")

```


_... and load those packages._
```{r loading_packages, message=FALSE, warning=FALSE}
source("scripts/packages.R")


```

_We will create a datestamp and define the Utrecht Science Park Colour Scheme_.
```{r Setting: Colors}

Today = format(as.Date(as.POSIXlt(Sys.time())), "%Y%m%d")
Today.Report = format(as.Date(as.POSIXlt(Sys.time())), "%A, %B %d, %Y")

source("scripts/colors.R")

```

```{r global_options, include = FALSE}
# further define some knitr-options.
knitr::opts_chunk$set(fig.width = 12, fig.height = 8, fig.path = 'Figures/', 
                      wwarning = TRUE, # show warnings during codebook generation
  message = TRUE, # show messages during codebook generation
  error = TRUE, # do not interrupt codebook generation in case of errors,
                # usually better for debugging
  echo = TRUE,  # show R code
                      eval = TRUE)
ggplot2::theme_set(ggplot2::theme_minimal())
pander::panderOptions("table.split.table", Inf)
```

# Introduction

We will parse the data to create regional association plots for each of the 11 loci. 

# Setting the NPG colors

```{r}
library("scales")
pal_npg("nrc")(10)
show_col(pal_npg("nrc")(10))

# show_col(pal_npg("nrc", alpha = 0.6)(10))

```


# Load data

We need to load the data first. This was generated in SAS with `scripts/simulateCaseControl.sas`.

```{r}

simdataAAO <- fread(file = paste0(PROJECT_loc, "/simulation_data/simulation_data_AAO.csv"))
str(simdataAAO)
```

```{r}
simdataStrokeCC <- fread(file = paste0(PROJECT_loc, "/simulation_data/simulation_data_StrokeCC.csv"))
str(simdataStrokeCC)

```

```{r}
library(dplyr)
simdataAAO <- simdataAAO %>%
    mutate(study = recode(study, 
                           "Additive Effect on Stroke" = "Additive genetic effect", 
                           "Multiplicative SNP Effect on Stroke" = "Multiplicative genetic effect", 
                           "SNP Effect on Death" = "Genetic effect on death"))
simdataAAO$Design <- "age-at-onset"

simdataStrokeCC <- simdataStrokeCC %>%
    mutate(study = recode(study, 
                           "Additive SNP Effect on Stroke" = "Additive genetic effect", 
                           "Multiplicative SNP Effect on Stroke" = "Multiplicative genetic effect", 
                           "SNP Effect on Death" = "Genetic effect on death"))
simdataStrokeCC$Design <- "case-control"

```

```{r}
simdata <- rbind(simdataAAO, simdataStrokeCC)
# create Design `as.factor`
simdata$Design <- as.factor(simdata$Design)
levels(simdata$Design)
simdata$Design <- factor(simdata$Design, levels=c("case-control", "age at onset"))
simdata$study <- factor(simdata$study, levels=c("Additive genetic effect", "Multiplicative genetic effect", "Genetic effect on death"))

dim(simdata)
head(simdata)
str(simdata)
```


# Simulation plotting

```{r}

ggpubr::ggline(simdata,
               x = "gEffect",
               y = "PERCENT",
               facet.by = "Design",
               color = "study", palette = "npg",
               plot_type = "l", 
               linetype = 1,
               size = 1.25,
               # shape = 19, 
               # stroke = 2,
               point.size = 1.25,
               # point.color = "npg",
               xlab = "Genetic effect size", ylab = "Power",
               ylim = c(0, 100),
               legend = "right",
               ggtheme = theme_minimal()) +
  theme(axis.line = element_line(size = 1, colour = uithof_color[25]),
        # legend.position = c(0, 1),
        legend.justification = c("left", "top"),
        legend.box.just = "left",
        legend.margin = margin(6, 6, 6, 6)) +
  labs(color = "Simulated genetic effect")

ggsave(paste0(PROJECT_loc, "/simulation_graph/SimulationResults.png"), plot = last_plot())
ggsave(paste0(PROJECT_loc, "/simulation_graph/SimulationResults.pdf"), plot = last_plot())
ggsave(paste0(PROJECT_loc, "/simulation_graph/SimulationResults.eps"), plot = last_plot())

```

# Session information

------

    Version:      v1.0.1
    Last update:  2023-08-21
    Written by:   Sander W. van der Laan (s.w.vanderlaan-2[at]umcutrecht.nl).
    Description:  Script to create simulation plot.
    Minimum requirements: R version 3.4.3 (2017-06-30) -- 'Single Candle', Mac OS X El Capitan
    
    Changes log
    * v1.0.1 Fixed genetic effects and power figure for clarity.
    * v1.0.0 Initial version. 

------

```{r eval = TRUE}
sessionInfo()
```


# Saving environment
```{r Saving}

save.image(paste0(PROJECT_loc, "/",Today,".",PROJECTNAME,".SimulationPlot.RData"))
```


------
<sup>&copy; 1979-2022 Sander W. van der Laan | s.w.vanderlaan[at]gmail.com | [swvanderlaan.github.io](https://swvanderlaan.github.io).</sup>
------


